---
title: 'í€ì‡íŒ€ì˜ ë¬´í•œìŠ¤í¬ë¡¤ ê°œë°œê¸°'
date: 2023-10-15 15:40:00
category: 'frontend'
draft: false
---

```
ğŸ“¢ ì´ ê¸€ì€ ë¬´í•œìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ë³´ë‹¤ëŠ” êµ¬í˜„ ê³¼ì •ì—ì„œ ìˆì—ˆë˜ ì¼ì— ëŒ€í•´ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.
```

í€ì‡ ì„œë¹„ìŠ¤ì—ëŠ” â€˜ìƒí’ˆ ëª©ë¡â€™ì„ ë³´ì—¬ì£¼ëŠ” í™”ë©´ê³¼ ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ì—ì„œ â€˜ë¦¬ë·° ëª©ë¡â€™ì„ ë³´ì—¬ì£¼ëŠ” í™”ë©´ì´ ìˆë‹¤. ì´ëŸ¬í•œ ê¸´ ëª©ë¡ë“¤ì„ ë³´ì—¬ì£¼ëŠ” ë°©ë²•ì—ëŠ” í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ë¬´í•œìŠ¤í¬ë¡¤ì´ ìˆë‹¤. ê·¸ ì¤‘ì—ì„œ ìš°ë¦¬ íŒ€ì€ ë¬´í•œìŠ¤í¬ë¡¤ ë°©ì‹ì„ ì„ íƒí–ˆê³  ì™œ ì´ ë°©ì‹ì„ ì„ íƒí–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ í–ˆëŠ”ì§€ ê¸€ì„ ì‘ì„±í•´ë³´ë ¤ê³  í•œë‹¤.

## í˜ì´ì§€ë„¤ì´ì…˜

<img width="353" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-08-06 á„‹á…©á„’á…® 2 00 16" src="https://github.com/woowacourse-teams/2023-fun-eat/assets/55427367/6357e995-89a5-4e99-9fa3-b28a29c77b7c">

í˜ì´ì§€ë„¤ì´ì…˜ì€ í™”ë©´ í•˜ë‹¨ì˜ ìˆ«ìë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•œ í˜ì´ì§€ ë„˜ë²„ì— í•´ë‹¹í•˜ëŠ” í˜ì´ì§€ë¥¼ ì„ íƒí•˜ëŠ” ë°©ì‹ì´ë‹¤. ëŒ€í‘œì ìœ¼ë¡œ êµ¬ê¸€ì´ ì´ëŸ° ë°©ì‹ì„ ì±„íƒí•˜ê³  ìˆë‹¤. (ìš”ì¦˜ì—ëŠ” ë”ë³´ê¸° ë²„íŠ¼ì´ ë³´ì´ëŠ” ê²ƒ ê°™ê¸°ë„..?)

ì¼ì •í•œ ì–‘ì„ ë§¤ë²ˆ ë³´ì—¬ì¤Œìœ¼ë¡œì¨ ì‚¬ìš©ìë“¤ì´ ì›í•˜ëŠ” ì»¨í…ì¸ ì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤. í˜ì´ì§•ì´ ì¼ì–´ë‚  ë•Œë§ˆë‹¤ ì‚¬ìš©ìëŠ” â€˜í´ë¦­â€™ì´ë¼ëŠ” í–‰ë™ì„ ì·¨í•´ì•¼ í•œë‹¤ëŠ” íŠ¹ì§•ì´ ìˆë‹¤.

## ë¬´í•œìŠ¤í¬ë¡¤

![ezgif com-video-to-gif (4)](https://github.com/woowacourse-teams/2023-fun-eat/assets/55427367/e3c98015-497c-4bbc-8613-f450200dbc48)

ë¬´í•œìŠ¤í¬ë¡¤ì€ ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤ì„ ë‚´ë¦´ ë•Œ í˜ì´ì§•ì´ ì¼ì–´ë‚˜ëŠ” ë°©ì‹ì´ë‹¤. ì‚¬ìš©ìë“¤ì´ ì§ì ‘ ì„ íƒí•œ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í¬ë¡¤ë§Œ í•´ë„ ìƒí’ˆë“¤ì´ ë” ë…¸ì¶œë˜ì–´ ì‚¬ìš©ìì˜ í–‰ë™ì„ ìµœì†Œí™”í•´ì¤€ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

ì–´ë–¤ UXë¥¼ ê³ ë¥¼ ê²ƒì¸ì§€ëŠ” ì„œë¹„ìŠ¤ì˜ ì˜ë„, í™˜ê²½ ë“±ì— ë”°ë¼ ë‹¬ë¼ì§€ê²Œ ëœë‹¤ê³  ìƒê°í•œë‹¤.

ì´ëŸ° ë¬´í•œìŠ¤í¬ë¡¤ë„ êµ¬í˜„ ë°©ë²•ì´ ë‚˜ë‰˜ëŠ”ë° scroll eventë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ intersection observerì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ë‚˜ë‰œë‹¤.

scroll eventëŠ” ë§¤ë²ˆ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚  ë•Œë§ˆë‹¤ ë†’ì´ë¥¼ ê°ì§€í•˜ëŠ” ë°©ì‹ì´ê³  intersection observerëŠ” êµì°¨í•˜ëŠ” ì§€ì ì„ ê°ì§€í•˜ì—¬ ë¬´í•œìŠ¤í¬ë¡¤ì„ í•˜ëŠ” ë°©ì‹ì´ë‹¤.

ìµœì¢…ì ìœ¼ë¡œ ìš°ë¦¬ íŒ€ì—ì„œëŠ” intersection observerë¥¼ ì‚¬ìš©í•œ ë¬´í•œìŠ¤í¬ë¡¤ ë°©ì‹ì„ ì±„íƒí•˜ê²Œ ë˜ì—ˆëŠ”ë° ê·¸ ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

1. í€ì‡ì€ ëª¨ë°”ì¼ ê¸°ì¤€ìœ¼ë¡œ ì œì‘ë˜ì–´ í´ë¦­ ì•¡ì…˜ì„ ìµœì†Œí™”í•œ ë¬´í•œìŠ¤í¬ë¡¤ì´ ë” ì¢‹ì€ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•  ê²ƒì„
2. í€ì‡ì—ëŠ” ìˆ˜ì²œê°œì˜ ìƒí’ˆì´ ì¡´ì¬í•˜ëŠ”ë° ì´ë¥¼ ë‚´ë¦´ ë•Œë§ˆë‹¤ ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤ë©´ í˜ì´ì§€ ë¶€í•˜ê°€ ì‹¬í•´ì§ˆ ê²ƒì„

## êµ¬í˜„ ë°©ë²•

### useIntersectionObserver hook ì‘ì„±

1. options

```tsx
const defaultOptions = {
  root: null,
  rootMargin: '0px',
  threshold: 0.3,
}
```

- `root`: íƒ€ê²Ÿ ìš”ì†Œì˜ ê°€ì‹œì„±ì„ ê²€ì‚¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë£¨íŠ¸ ìš”ì†Œ (`null` ì¼ ë•Œ ë¸Œë¼ìš°ì € ë·°í¬íŠ¸ë¡œ ì„¤ì •)
- `rootMargin`: ë£¨íŠ¸ìš”ì†Œì˜ ë²”ìœ„ë¥¼ í™•ì¥í•˜ì—¬ í™•ì¥ëœ ì˜ì—­ì— ë“¤ì–´ê°€ë©´ ê°€ì‹œì„± ë³€í™” ë°œìƒí•˜ê²Œ í•œë‹¤. ë‹¨ìœ„ë¥¼ í•„ìˆ˜ì ìœ¼ë¡œ ì ì–´ì¤˜ì•¼ í•œë‹¤.
- `threshold`: ìš”ì†Œê°€ ì–´ëŠì •ë„ë¡œ ë³´ì—¬ì¡Œì„ ë•Œ ì½œë°±ì„ ì‹¤í–‰í•  ê²ƒì¸ì§€ ê²°ì •

1. observer ìƒì„±

```tsx
const observer = useRef(
  new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        callback()
      }
    })
  }, defaultOptions)
)
```

1. observe, unobserve í•¨ìˆ˜ ì‘ì„±

```tsx
const observe = (element: T) => {
  observer.current.observe(element);
};

const unobserve = (element: T) => {
  observer.current.unobserve(element);
};

useEffect(() => {
  if (!targetRef.current) {
    return;
  }

  if (isLastPage) {
    unobserve(targetRef.current);
    return;
  }

  observe(targetRef.current);

  return () => {
	    observer.current.disconnect();
	  };
	}, [targetRef.current]);
};
```

### ì™„ì„±ë³¸

```tsx
import type { RefObject } from 'react';
import { useRef, useEffect } from 'react';

const defaultOptions = {
  root: null,
  rootMargin: '0px',
  threshold: 1.0,
};

const useIntersectionObserver = <T extends HTMLElement>(
  callback: () => void,
  targetRef: RefObject<T>,
  isLastPage: boolean | undefined
) => {
  let isInitial = true;

  const observer = useRef(
    new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          if (isInitial) {
            isInitial = false;
          } else {
            callback();
          }
        }
      });
    }, defaultOptions)
  );

  const observe = (element: T) => {
    observer.current.observe(element);
  };

  const unobserve = (element: T) => {
    observer.current.unobserve(element);
  };

  useEffect(() => {
    if (!targetRef.current) {
      return;
    }

    if (isLastPage) {
      unobserve(targetRef.current);
      return;
    }

    observe(targetRef.current);

    return () => {
      observer.current.disconnect();
    };
  }, [targetRef.current]);
};
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

í€ì‡ì—ëŠ” ì—¬ëŸ¬ê°œì˜ ì¹´í…Œê³ ë¦¬ê°€ ì¡´ì¬í•œë‹¤. ì¼ë°˜ ìƒí’ˆ 5ê°€ì§€, PB ìƒí’ˆ 4ê°€ì§€ë¡œ ì´ 9ê°€ì§€ì˜ íƒ­ì—ì„œ ëª¨ë‘ ë¬´í•œìŠ¤í¬ë¡¤ì´ ì¼ì–´ë‚˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìê°€ ì¹´í…Œê³ ë¦¬ íƒ­ì„ ë°”ê¿€ ë•Œë§ˆë‹¤ `page = 0` ìœ¼ë¡œ ì´ˆê¸°í™”í•´ì„œ ìš”ì²­ì„ ë³´ë‚´ì•¼í–ˆë‹¤.

ì´ ë•Œ, page ê°’ ì´ˆê¸°í™”ì™€ ë¹„ë™ê¸° ìš”ì²­ì˜ ìˆœì„œë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê°„í¸ì‹ì‚¬ íƒ­ì—ì„œ `page = 4` ê¹Œì§€ì˜ ìš”ì²­ì„ ë³´ë‚¸ ë’¤ ê³¼ìë¥˜ íƒ­ìœ¼ë¡œ ì´ë™í–ˆì„ ë•Œ `page = 4` ì˜ ìš”ì²­ì´ ë¨¼ì € ê°„ ë’¤ `page = 0` ìš”ì²­ì´ ì¼ì–´ë‚˜ëŠ” ê²ƒì´ì—ˆë‹¤.

ë„ëŒ€ì²´ ì™œ ì´ëŸ° í˜„ìƒì´ ì¼ì–´ë‚˜ëŠ” ê²ƒì¼ê¹Œ ê³ ë¯¼í•´ë´¤ëŠ”ë° ë‚´ê°€ ìƒê°í•œ ë¬¸ì œì ì€ ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

ë¬´í•œìŠ¤í¬ë¡¤ì„ í•  ë•Œ ë‘ ê°€ì§€ì˜ ì‘ì—…ì„ í•˜ê²Œ ëœë‹¤.

1. `setPage` ë¥¼ í†µí•´ pageë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê³¼ì •

2. íŒ€ ë‚´ì—ì„œ ë§Œë“  `useGet` ì„ í†µí•´ dataë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³¼ì • â†’ ì´ ë•Œ ì˜ì¡´ì„± ë°°ì—´ `[categoryId, page]` ê°€ ì¡´ì¬í•œë‹¤.

ì´ë•Œ page ìƒíƒœê°€ 0ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ê¸° ì „ì— API ìš”ì²­ì´ ì™„ë£Œë˜ì–´ ìƒí’ˆ ëª©ë¡ì„ ì‘ë‹µí•˜ê²Œ ë˜ë©´ ë‘ ê³¼ì • ì‚¬ì´ì˜ race conditionì´ ë°œìƒí•˜ëŠ” ê²ƒìœ¼ë¡œ íŒë‹¨í–ˆìŠµë‹ˆë‹¤. setStateë¥¼ í•˜ëŠ” í•¨ìˆ˜ëŠ” ë Œë”ë§ ë™ì¼ì„±ì´ ë³´ì¥ë˜ì§€ë§Œ ë¹„ë™ê¸° ìš”ì²­ì€ ìˆœì„œë¥¼ ë³´ì¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

**ğŸ¤”Â í•´ê²°ë°©ì•ˆ**

ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ìƒê°í–ˆë˜ ë°©ë²•ì€ ì¹´í…Œê³ ë¦¬ê°’ì´ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•˜ê³  ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì´ì—ˆë‹¤. ê³µì‹ ë¬¸ì„œì—ì„œ refëŠ” ì–´ë– í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì‹¶ì§€ë§Œ ë Œë”ëŠ” ì¼ìœ¼í‚¤ê³  ì‹¶ì§€ëŠ” ì•Šì„ ë•Œë„ ì‚¬ìš©í•œë‹¤ëŠ” ë‚´ìš©ì„ ì°¸ê³ í•´ í•´ë‹¹ ë°©ë²•ìœ¼ë¡œ ì ‘ê·¼í–ˆë‹¤.

`previousCategoryId`ë¥¼ refë¡œ ê°’ì„ ì €ì¥

ê·¸ í›„ `categoryId`ì™€ ë¹„êµí•´ì„œ ê°’ì´ ë°”ë€Œì—ˆë‹¤ë©´ `page`ë¥¼ ì´ˆê¸°í™” í•œ í›„ ë¹„ë™ê¸° ìš”ì²­ì„ ë³´ë‚´ê²Œë” êµ¬í˜„

```tsx
const prevCategoryId = useRef(categoryId)
const nextPage = prevCategoryId.current !== categoryId ? 0 : page

useEffect(() => {
  setPage(0) //ì´ˆê¸°í™”
  prevCategoryId.current = categoryId
}, [categoryId, sort])

// useCategoryProductsì— ì „ë‹¬í•´ì£¼ëŠ” ê°’ë“¤ì´ refetch ì¡°ê±´ì„
const { data: productListResponse } = useCategoryProducts(
  categoryId,
  nextPage,
  sort
) //ë¹„ë™ê¸° ìš”ì²­
```

ë¬¼ë¡  ì´ ë¬¸ì œëŠ” [Suspense](https://react.dev/blog/2022/03/29/react-v18#new-suspense-features)ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ê²°ì´ ê°€ëŠ¥í•˜ë‹¤.

ì´ì— ëŒ€í•´ì„œëŠ” 2íƒ„ìœ¼ë¡œ ì´ì–´ì ì–´ë³´ë„ë¡ í•˜ê² ë‹¤!
